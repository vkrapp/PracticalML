<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Practicalml : ">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Practicalml</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/vkrapp/PracticalML">View on GitHub</a>

          <h1 id="project_title">Practicalml</h1>
          <h2 id="project_tagline"></h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/vkrapp/PracticalML/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/vkrapp/PracticalML/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <hr>

<p>title: "Predicting Exercise Performance with Accelerometer Data"
author: "vkrapp"
date: "Sunday, April 19, 2015"</p>

<h2>
<a id="output-pdf_document" class="anchor" href="#output-pdf_document" aria-hidden="true"><span class="octicon octicon-link"></span></a>output: pdf_document</h2>

<h2>
<a id="executive-summary" class="anchor" href="#executive-summary" aria-hidden="true"><span class="octicon octicon-link"></span></a>Executive summary</h2>

<p>In this project, we use data from accelerometers on the belt, forearm, arm, and dumbell of 6 participants. They were asked to perform barbell lifts correctly and incorrectly in 5 different ways: exactly according to the specification (Class A), throwing the elbows to the front (Class B), lifting the dumbbell only halfway (Class C), lowering the dumbbell only halfway (Class D) and throwing the hips to the front (Class E).
Class A corresponds to the specified execution of the exercise, while the other 4 classes correspond to common mistakes. More information is available from the website here: <a href="http://groupware.les.inf.puc-rio.br/har">http://groupware.les.inf.puc-rio.br/har</a>. The goal of the project was to predict the manner in which they did the exercise. 
After cleaning the data, the random forest algorithm was applied to build the model.</p>

<h2>
<a id="needed-packages" class="anchor" href="#needed-packages" aria-hidden="true"><span class="octicon octicon-link"></span></a>Needed Packages</h2>

<div class="highlight highlight-r"><pre>library(<span class="pl-smi">caret</span>)</pre></div>

<h2>
<a id="reading-and-cleaning-data" class="anchor" href="#reading-and-cleaning-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reading and Cleaning Data</h2>

<p>First, we read the data into R and remove all columns that include empty spaces or NAs, since these columns are not useful for fitting models.The data files are already downloaded and saved in the current working directory.</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">train</span> <span class="pl-k">&lt;-</span> read.csv(<span class="pl-s"><span class="pl-pds">"</span>pml-training.csv<span class="pl-pds">"</span></span>, <span class="pl-v">na.strings</span> <span class="pl-k">=</span> c(<span class="pl-s"><span class="pl-pds">"</span>NA<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>))
<span class="pl-smi">test</span> <span class="pl-k">&lt;-</span>  read.csv(<span class="pl-s"><span class="pl-pds">"</span>pml-testing.csv<span class="pl-pds">"</span></span>, <span class="pl-v">na.strings</span> <span class="pl-k">=</span> c(<span class="pl-s"><span class="pl-pds">"</span>NA<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)) <span class="pl-c"># This data set is for the submission</span>
dim(<span class="pl-smi">train</span>) <span class="pl-c">#19622   160 -&gt; large sample</span>
dim(<span class="pl-smi">test</span>) <span class="pl-c">#20 160</span>
<span class="pl-c"># All variables that include NAs or empty space are removed:</span>
<span class="pl-smi">complete</span> <span class="pl-k">&lt;-</span> complete.cases(t(<span class="pl-smi">train</span>))
<span class="pl-smi">train</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">train</span>[,<span class="pl-smi">complete</span>]
<span class="pl-smi">test</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">test</span>[,<span class="pl-smi">complete</span>]                   </pre></div>

<p>Next, variables that include timing information or the index of the observation are removed because they do not provide relevant information for our model.  </p>

<div class="highlight highlight-r"><pre><span class="pl-smi">train</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">train</span>[,c(<span class="pl-k">-</span><span class="pl-c1">1</span>,<span class="pl-k">-</span><span class="pl-c1">3</span><span class="pl-k">:</span><span class="pl-k">-</span><span class="pl-c1">7</span>)]
<span class="pl-smi">test</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">test</span>[,c(<span class="pl-k">-</span><span class="pl-c1">1</span>,<span class="pl-k">-</span><span class="pl-c1">3</span><span class="pl-k">:</span><span class="pl-k">-</span><span class="pl-c1">7</span>)]
dim(<span class="pl-smi">train</span>) <span class="pl-c">#19622    54</span></pre></div>

<p>With this simplified data set we are going to build our model.</p>

<h2>
<a id="cross-validation-and-model-fitting" class="anchor" href="#cross-validation-and-model-fitting" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cross Validation and Model Fitting</h2>

<p>The data set is splitted into a training (70%) and a test (validation) set (30%). We perform the random forest algorithm only on the training set with a 5-fold cross-validation. To estimate the out-of-sample-error, we test our model`s accuracy on an independent test set. </p>

<div class="highlight highlight-r"><pre>set.seed(<span class="pl-c1">2005</span>)
<span class="pl-smi">inTrain</span> <span class="pl-k">&lt;-</span> createDataPartition(<span class="pl-v">y</span><span class="pl-k">=</span><span class="pl-smi">train</span><span class="pl-k">$</span><span class="pl-smi">classe</span>, <span class="pl-v">p</span><span class="pl-k">=</span><span class="pl-c1">0.7</span>, <span class="pl-v">list</span><span class="pl-k">=</span><span class="pl-c1">FALSE</span>)
<span class="pl-smi">training</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">train</span>[<span class="pl-smi">inTrain</span>,]
<span class="pl-smi">testing</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">train</span>[<span class="pl-k">-</span><span class="pl-smi">inTrain</span>,]

<span class="pl-c"># Fit model</span>
set.seed(<span class="pl-c1">2005</span>)
<span class="pl-smi">modelFit</span> <span class="pl-k">&lt;-</span> train(<span class="pl-smi">classe</span><span class="pl-k">~</span>., <span class="pl-v">method</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>rf<span class="pl-pds">"</span></span>, <span class="pl-v">data</span><span class="pl-k">=</span><span class="pl-smi">training</span>, 
                  <span class="pl-v">trControl</span> <span class="pl-k">=</span> trainControl(<span class="pl-v">method</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>cv<span class="pl-pds">"</span></span>, <span class="pl-v">number</span> <span class="pl-k">=</span> <span class="pl-c1">5</span>))
<span class="pl-smi">modelFit</span>
<span class="pl-smi">modelFit</span><span class="pl-k">$</span><span class="pl-smi">finalModel</span>

<span class="pl-c"># Test model on testing data</span>
<span class="pl-smi">predictions</span> <span class="pl-k">&lt;-</span> predict(<span class="pl-smi">modelFit</span>, <span class="pl-smi">testing</span>)

<span class="pl-c"># Evaluation of prediction</span>
<span class="pl-smi">matrix</span> <span class="pl-k">&lt;-</span> confusionMatrix(<span class="pl-smi">predictions</span>,<span class="pl-smi">testing</span><span class="pl-k">$</span><span class="pl-smi">classe</span>)
<span class="pl-smi">matrix</span></pre></div>

<p>So with this approach, we get a accuracy of <code>r matrix$overall[[1]]</code> on our testing data set. This is a pretty good prediction.<br>
In a next step, the ten most important variables for the model are plotted.</p>

<div class="highlight highlight-r"><pre><span class="pl-c"># Get the variable importance</span>
<span class="pl-smi">VarImportance</span> <span class="pl-k">&lt;-</span> varImp(<span class="pl-smi">modelFit</span>)
<span class="pl-c"># Plot the 10 most important predictors</span>
plot(<span class="pl-smi">VarImportance</span>, <span class="pl-v">main</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Top 10 of the Most Important Predictors<span class="pl-pds">"</span></span>, <span class="pl-v">top</span> <span class="pl-k">=</span> <span class="pl-c1">10</span>)
</pre></div>

<h2>
<a id="submission" class="anchor" href="#submission" aria-hidden="true"><span class="octicon octicon-link"></span></a>Submission</h2>

<p>In the end, we use our model to predict the classes of the 20 test cases.</p>

<div class="highlight highlight-r"><pre><span class="pl-v">answers</span> <span class="pl-k">=</span> predict(<span class="pl-smi">modelFit</span>, <span class="pl-smi">test</span>)
<span class="pl-v">pml_write_files</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">x</span>){
    <span class="pl-v">n</span> <span class="pl-k">=</span> length(<span class="pl-smi">x</span>)
    <span class="pl-k">for</span>(<span class="pl-smi">i</span> <span class="pl-k">in</span> <span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-smi">n</span>){
        <span class="pl-v">filename</span> <span class="pl-k">=</span> paste0(<span class="pl-s"><span class="pl-pds">"</span>problem_id_<span class="pl-pds">"</span></span>,<span class="pl-smi">i</span>,<span class="pl-s"><span class="pl-pds">"</span>.txt<span class="pl-pds">"</span></span>)
        write.table(<span class="pl-smi">x</span>[<span class="pl-smi">i</span>],<span class="pl-v">file</span><span class="pl-k">=</span><span class="pl-smi">filename</span>,<span class="pl-v">quote</span><span class="pl-k">=</span><span class="pl-c1">FALSE</span>,<span class="pl-v">row.names</span><span class="pl-k">=</span><span class="pl-c1">FALSE</span>,<span class="pl-v">col.names</span><span class="pl-k">=</span><span class="pl-c1">FALSE</span>)
        }
    }
pml_write_files(<span class="pl-smi">answers</span>)</pre></div>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Practicalml maintained by <a href="https://github.com/vkrapp">vkrapp</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
